name : Postman Collection Workflow
on :
  push :
    branches : [main]
  workflow_dispatch : 
  schedule :
    - cron : 30 02 * * * #8AM IST
    - cron : 30 14 * * * 
jobs :
  run-postman-tests :
    runs-on  : ubuntu-latest

    steps :
      - name : checkout the code
        uses: actions/checkout@v6.0.1

      - name : Install NodeJS and NPM
        uses : actions/setup-node@v6.1.0
        with:
          node-version : '22'

      - name : Install NewMan and HTMLExtra
        run : |
              npm install -g newman
              npm install -g newman-reporter-htmlextra
              
      - name : Run the Postman Collection with Newman
        run : |
              newman run 'Inwarranty-flow Collection.postman_collection.json' \
              -e QA.postman_environment.json \
              -d TestData.csv \
              -r cli,htmlextra \
              --reporter-htmlextra-export ./newman/index.html

      - name : Upload Artifact
        if : always()
        uses : actions/upload-artifact@v6.0.0
        with : 
          name : Newman Report
          path : newman/*.html

      - name : Creating Github Page Branch
        if : always()
        uses : peaceiris/actions-gh-pages@v4.0.0
        with :
          github_token : ${{ secrets.GITHUB_TOKEN }}
          publish_dir : newman/

      - name : Send Email Notifications
        if : always()
        uses: dawidd6/action-send-mail@v7
        with :
          server_address : smptp.gmail.com
          server_port : 465
          username : ${{ secrets.EMAIL_USERNAME }}
          password : ${{ secrets.EMAIL_PASSWORD }}
          subject : Phoenix-Inwarranty-flow Test Execution Notification
          to : krishnanvssandeep@gmail.com
          from : ${{ secrets.EMAIL_USERNAME }}
          body : |
                HI,
                Phoenix Inwarranty Flow has been Executed. The Report has bee published and the URL is : https://sandeepknvs.github.io/Phoenix-Inwarranty-Flow/
          
        
        
          
          
        
